<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TCP Streamer</title>
    <script type="module" src="/main.js" defer></script>
  </head>
  <body>
    <div class="glass-panel">
      <div class="header">
        <h1>TCP Streamer</h1>
        <div class="status-badge" id="status-badge">
          <span class="status-dot"></span>
          <span id="status-text">Ready</span>
        </div>
      </div>

      <!-- Statistics Bar -->
      <div class="stats-bar" id="stats-bar">
        <div class="stat-item">
          <span class="stat-label">Uptime</span>
          <span class="stat-value" id="stat-uptime">--:--</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Transferred</span>
          <span class="stat-value" id="stat-bytes">0 MB</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Bitrate</span>
          <span class="stat-value" id="stat-bitrate">0 kbps</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Quality</span>
          <span class="stat-value" id="stat-quality">
            <span class="quality-indicator">‚óè</span> --
          </span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Jitter</span>
          <span class="stat-value" id="stat-jitter">-- ms</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Buffer</span>
          <span class="stat-value" id="stat-buffer">-- ms</span>
        </div>
      </div>

      <!-- Tabs Navigation -->
      <div class="tabs-nav">
        <button
          class="tab-btn active"
          data-tab="tab-connection"
          data-tooltip="Connection"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 20h.01" />
            <path d="M2 20h.01" />
            <path d="M22 20h.01" />
            <path d="M5 12a7 7 0 0 1 14 0" />
            <path d="M8.5 15.5a3.5 3.5 0 0 1 7 0" />
          </svg>
        </button>
        <button class="tab-btn" data-tab="tab-audio" data-tooltip="Audio">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M11 5L6 9H2v6h4l5 4V5z" />
            <path
              d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"
            />
          </svg>
        </button>
        <button class="tab-btn" data-tab="tab-settings" data-tooltip="Settings">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
            />
            <circle cx="12" cy="12" r="3" />
          </svg>
        </button>
        <button class="tab-btn" data-tab="tab-advanced" data-tooltip="Advanced">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M2 12h20" />
            <path d="M2 12l5-5" />
            <path d="M2 12l5 5" />
            <path d="M22 12l-5-5" />
            <path d="M22 12l-5 5" />
            <path d="M12 7v10" />
          </svg>
        </button>
        <button class="tab-btn" data-tab="tab-logs" data-tooltip="Logs">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
        </button>
        <button
          class="tab-btn"
          data-tab="tab-docs"
          data-tooltip="Documentation"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
            <path
              d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
            />
          </svg>
        </button>
      </div>

      <div class="tab-content">
        <!-- Tab 1: Connection -->
        <div class="tab-pane active" id="tab-connection">
          <div class="settings-card">
            <h3>Source</h3>
            <div class="control-group">
              <label for="device-select">Input Device</label>
              <div class="select-wrapper">
                <select id="device-select">
                  <option value="" disabled selected>Loading devices...</option>
                </select>
              </div>
            </div>
            <div
              id="loopback-container"
              class="control-group"
              style="margin-top: 10px"
            >
              <label class="checkbox-container">
                <input type="checkbox" id="loopback-mode" />
                <span class="checkmark"></span>
                Enable Loopback (Windows)
              </label>
              <small
                style="
                  color: rgba(255, 255, 255, 0.6);
                  font-size: 11px;
                  margin-top: 4px;
                  display: block;
                "
              >
                Capture system audio directly without virtual cables (requires
                speakers/headphones connected)
              </small>
            </div>
          </div>

          <div class="settings-card">
            <h3>Destination</h3>
            <div class="row">
              <div class="control-group">
                <label for="ip-input">Target IP</label>
                <input type="text" id="ip-input" placeholder="192.168.1.100" />
              </div>
              <div class="control-group">
                <label for="port-input">Port</label>
                <input
                  type="number"
                  id="port-input"
                  placeholder="1704"
                  value="1704"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Audio -->
        <div class="tab-pane" id="tab-audio">
          <div class="settings-card">
            <h3>Audio Configuration</h3>
            <div class="row">
              <div class="control-group">
                <label for="sample-rate">Sample Rate</label>
                <div class="select-wrapper">
                  <select id="sample-rate">
                    <option value="48000">48 kHz</option>
                    <option value="44100">44.1 kHz</option>
                  </select>
                </div>
              </div>
              <div class="control-group">
                <label for="buffer-size">Buffer Size</label>
                <div class="select-wrapper">
                  <select id="buffer-size">
                    <option value="256">Low (256)</option>
                    <option value="512">Medium (512)</option>
                    <option value="1024" selected>High (1024)</option>
                    <option value="2048">Max (2048)</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row" style="margin-top: 10px">
              <div class="control-group">
                <label for="ring-buffer-duration">Ring Buffer (ms)</label>
                <div class="select-wrapper">
                  <select id="ring-buffer-duration">
                    <option value="2000">Low (2000ms)</option>
                    <option value="4000" selected>Balanced (4000ms)</option>
                    <option value="8000">High (8000ms)</option>
                    <option value="15000">Max (15000ms)</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Adaptive Buffer Section (Moved here) -->
            <div
              class="settings-card"
              style="
                margin-top: 15px;
                margin-bottom: 15px;
                background: rgba(0, 0, 0, 0.2);
              "
            >
              <h3
                style="
                  font-size: 0.9rem;
                  margin-bottom: 10px;
                  color: var(--accent-color);
                "
              >
                Adaptive Buffer
              </h3>

              <div class="control-group" style="margin-bottom: 15px">
                <label class="checkbox-container">
                  <input type="checkbox" id="adaptive-buffer-check" />
                  <span class="checkmark"></span>
                  Enable Adaptive Buffer Sizing
                </label>
                <small
                  style="
                    display: block;
                    margin-top: 6px;
                    margin-left: 28px;
                    color: rgba(255, 255, 255, 0.5);
                    line-height: 1.3;
                  "
                >
                  Automatically adjust buffer size based on network jitter
                </small>
              </div>

              <div class="row">
                <div class="control-group">
                  <label
                    for="min-buffer"
                    style="
                      margin-bottom: 6px;
                      display: block;
                      font-size: 0.85rem;
                    "
                    >Min Buffer (ms)</label
                  >
                  <input
                    type="number"
                    id="min-buffer"
                    value="2000"
                    min="1000"
                    max="5000"
                    step="500"
                    style="padding: 8px"
                  />
                </div>
                <div class="control-group">
                  <label
                    for="max-buffer"
                    style="
                      margin-bottom: 6px;
                      display: block;
                      font-size: 0.85rem;
                    "
                    >Max Buffer (ms)</label
                  >
                  <input
                    type="number"
                    id="max-buffer"
                    value="10000"
                    min="5000"
                    max="20000"
                    step="1000"
                    style="padding: 8px"
                  />
                </div>
              </div>
            </div>

            <div class="settings-card" style="margin-top: 15px">
              <h3>Silence Detection</h3>

              <!-- Disable Silence Detection Checkbox -->
              <div class="control-group" style="margin-bottom: 16px">
                <label class="checkbox-container">
                  <input type="checkbox" id="disable-silence-detection" />
                  <span class="checkmark"></span>
                  Disable Silence Detection (Always Transmit)
                </label>
                <small
                  style="
                    color: rgba(255, 255, 255, 0.5);
                    font-size: 11px;
                    margin-top: 6px;
                    display: block;
                    line-height: 1.4;
                  "
                >
                  Bypass all silence detection logic and always transmit audio
                </small>
              </div>

              <!-- Real-time Volume Indicator -->
              <div class="control-group" style="margin-bottom: 20px">
                <label style="margin-bottom: 8px; display: block"
                  >Current Volume (RMS)</label
                >
                <div
                  style="
                    background: rgba(0, 0, 0, 0.3);
                    border-radius: 8px;
                    padding: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                  "
                >
                  <div style="display: flex; align-items: center; gap: 12px">
                    <div
                      style="
                        flex: 1;
                        height: 24px;
                        background: rgba(0, 0, 0, 0.4);
                        border-radius: 12px;
                        overflow: hidden;
                        position: relative;
                      "
                    >
                      <div
                        id="volume-bar"
                        style="
                          height: 100%;
                          width: 0%;
                          background: linear-gradient(
                            to right,
                            #10b981,
                            #3b82f6,
                            #f59e0b,
                            #ef4444
                          );
                          transition: width 0.1s ease-out;
                          border-radius: 12px;
                        "
                      ></div>
                      <div
                        id="threshold-marker"
                        style="
                          position: absolute;
                          top: 0;
                          bottom: 0;
                          width: 2px;
                          background: #fff;
                          left: 5%;
                          box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
                        "
                      ></div>
                    </div>
                    <div
                      style="
                        display: flex;
                        flex-direction: column;
                        align-items: flex-end;
                      "
                    >
                      <span
                        id="volume-value"
                        style="
                          font-family: 'Fira Code', monospace;
                          font-size: 0.9rem;
                          min-width: 40px;
                          text-align: right;
                          color: var(--accent-color);
                          font-weight: bold;
                        "
                        >0</span
                      >
                      <span
                        id="avg-volume-value"
                        style="
                          font-family: 'Fira Code', monospace;
                          font-size: 0.7rem;
                          color: rgba(255, 255, 255, 0.5);
                        "
                        >Avg: 0</span
                      >
                    </div>
                  </div>
                  <small
                    style="
                      display: block;
                      margin-top: 8px;
                      color: rgba(255, 255, 255, 0.5);
                      text-align: center;
                    "
                  >
                    White line shows threshold. Volume below = silence detected
                  </small>
                </div>
              </div>

              <!-- Silence Detection Controls (hideable when disabled) -->
              <div id="silence-settings-container">
                <div class="control-group" style="margin-bottom: 16px">
                  <label
                    for="silence-threshold"
                    style="margin-bottom: 8px; display: block"
                    >Silence Threshold (RMS)</label
                  >
                  <input
                    type="number"
                    id="silence-threshold"
                    min="0"
                    max="10000"
                    step="1"
                    value="0"
                    style="
                      width: 100%;
                      padding: 10px 12px;
                      background: rgba(0, 0, 0, 0.2);
                      border: 1px solid rgba(255, 255, 255, 0.1);
                      border-radius: 8px;
                      color: white;
                    "
                  />
                  <small
                    style="
                      color: rgba(255, 255, 255, 0.5);
                      font-size: 11px;
                      margin-top: 6px;
                      display: block;
                      line-height: 1.4;
                    "
                  >
                    Lower values = less aggressive silence detection (prevents
                    fade-out cuts). Default: 5
                  </small>
                </div>

                <div class="control-group">
                  <label
                    for="silence-timeout"
                    style="margin-bottom: 8px; display: block"
                    >Silence Timeout (seconds)</label
                  >
                  <input
                    type="number"
                    id="silence-timeout"
                    min="0"
                    max="300"
                    step="1"
                    value="0"
                    style="
                      width: 100%;
                      padding: 10px 12px;
                      background: rgba(0, 0, 0, 0.2);
                      border: 1px solid rgba(255, 255, 255, 0.1);
                      border-radius: 8px;
                      color: white;
                    "
                  />
                  <small
                    style="
                      color: rgba(255, 255, 255, 0.5);
                      font-size: 11px;
                      margin-top: 6px;
                      display: block;
                      line-height: 1.4;
                    "
                  >
                    Stop transmission after X seconds of silence (0 = never
                    stop, always transmit)
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab 2: Settings -->
        <div class="tab-pane" id="tab-settings">
          <!-- Profiles Card -->
          <div class="settings-card">
            <h3>Configuration Profiles</h3>
            <div
              class="profiles-section"
              id="profiles-section"
              style="display: block; background: none; padding: 0"
            >
              <div class="control-group">
                <label for="profile-select">Select Profile</label>
                <select id="profile-select" class="profile-select"></select>
              </div>
              <div
                class="profile-actions"
                style="margin-top: 10px; justify-content: flex-start"
              >
                <button
                  id="btn-save-profile"
                  class="btn-small"
                  title="Save current settings to this profile"
                >
                  üíæ Save
                </button>
                <button
                  id="btn-new-profile"
                  class="btn-small"
                  title="Create a new profile"
                >
                  ‚ûï New
                </button>
                <button
                  id="btn-delete-profile"
                  class="btn-small btn-danger"
                  title="Delete this profile"
                >
                  üóëÔ∏è Delete
                </button>
              </div>
              <div
                class="new-profile-input"
                id="new-profile-container"
                style="display: none"
              >
                <input
                  type="text"
                  id="new-profile-name"
                  placeholder="Enter Profile Name"
                />
                <button id="btn-confirm-profile" class="btn-small btn-success">
                  ‚úì Create
                </button>
                <button id="btn-cancel-profile" class="btn-small">
                  ‚úï Cancel
                </button>
              </div>
            </div>
          </div>

          <!-- Automation Card -->
          <div class="settings-card">
            <h3>Automation</h3>
            <div class="control-group">
              <label class="checkbox-container">
                <input type="checkbox" id="autostart-check" />
                <span class="checkmark"></span>
                Auto-start on launch
              </label>
              <label class="checkbox-container">
                <input type="checkbox" id="autostream-check" />
                <span class="checkmark"></span>
                Auto-stream on load
              </label>
              <label class="checkbox-container">
                <input type="checkbox" id="autoreconnect-check" />
                <span class="checkmark"></span>
                Auto-Reconnect
              </label>
            </div>
          </div>
        </div>

        <!-- Tab 3: Advanced -->
        <div class="tab-pane" id="tab-advanced">
          <div class="settings-card">
            <h3>Advanced Network</h3>
            <div class="control-group">
              <div class="form-group checkbox-group">
                <input type="checkbox" id="priority-check" checked />
                <label for="priority-check">High Priority Thread</label>
              </div>
              <div class="form-group">
                <label for="dscp-select">DSCP Strategy</label>
                <select id="dscp-select">
                  <option value="voip">VoIP (EF - 0xB8)</option>
                  <option value="lowdelay">Low Delay (0x10)</option>
                  <option value="throughput">Throughput (0x08)</option>
                  <option value="besteffort">Best Effort (0x00)</option>
                </select>
              </div>
              <div class="form-group">
                <label for="chunk-size-select">Chunk Size (Samples)</label>
                <select id="chunk-size-select">
                  <option value="128">128 (Ultra Low Latency)</option>
                  <option value="256">256 (Very Low Latency)</option>
                  <option value="512" selected>512 (Low Latency)</option>
                  <option value="1024">1024 (Stable)</option>
                  <option value="2048">2048 (High Stability)</option>
                  <option value="4096">4096 (Max Stability)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="settings-card">
            <h3>Active Rate Control</h3>
            <div class="control-group">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                  <label class="checkbox-container">
                    <input type="checkbox" id="auto-sync-check" />
                    <span class="checkmark"></span>
                    Automatic Synchronization
                  </label>
                  <span id="drift-status" style="font-family: 'Fira Code', monospace; font-size: 0.8rem; color: var(--accent-color);">
                    0 ppm
                  </span>
              </div>
              
              <label
                for="drift-correction"
                style="margin-bottom: 8px; display: block"
                >Manual Correction (PPM)</label
              >
              <div style="display: flex; align-items: center; gap: 10px">
                <input
                  type="range"
                  id="drift-correction-slider"
                  min="-2000"
                  max="2000"
                  step="10"
                  value="0"
                  style="flex: 1"
                />
                <input
                  type="number"
                  id="drift-correction-input"
                  min="-2000"
                  max="2000"
                  step="10"
                  value="0"
                  style="
                    width: 70px;
                    padding: 8px;
                    background: rgba(0, 0, 0, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 6px;
                    color: white;
                    text-align: center;
                  "
                />
              </div>
              <small
                style="
                  display: block;
                  margin-top: 8px;
                  color: rgba(255, 255, 255, 0.5);
                  line-height: 1.4;
                "
              >
                Fine-tune playback speed to fix clock drift.<br />
                <span style="color: #ef4444">Negative</span> (-): Fixes latency
                accumulation (Recv-Q growth).<br />
                <span style="color: #10b981">Positive</span> (+): Fixes audio
                dropouts/underruns.
              </small>
            </div>
          </div>

          <div class="settings-card">
            <h3>Network Presets</h3>
            <div class="control-group">
              <label for="network-preset">Connection Type</label>
              <div class="select-wrapper">
                <select id="network-preset">
                  <option value="custom">Custom</option>
                  <option value="ethernet">Ethernet (Stable)</option>
                  <option value="wifi">WiFi (Standard)</option>
                  <option value="wifi-poor">WiFi (Poor Signal)</option>
                </select>
              </div>
              <small
                style="
                  display: block;
                  margin-top: 8px;
                  color: rgba(255, 255, 255, 0.6);
                "
                >Optimized settings for your connection type</small
              >
            </div>
          </div>
        </div>

        <!-- Tab: Logs -->
        <div class="tab-pane" id="tab-logs">
          <div class="settings-card" style="margin-top: 0">
            <div
              class="logs-header"
              style="
                background: none;
                padding-left: 0;
                padding-right: 0;
                border-radius: 0;
                margin-bottom: 10px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
              "
            >
              <h3>Logs</h3>
              <div class="logs-controls">
                <select id="log-filter">
                  <option value="all">All Levels</option>
                  <option value="info">Info</option>
                  <option value="warning">Warning</option>
                  <option value="error">Error</option>
                  <option value="debug">Debug</option>
                  <option value="trace">Trace</option>
                  <option value="sync">Sync</option>
                </select>
                <button id="clear-logs-btn" class="btn secondary small">
                  Clear
                </button>
              </div>
            </div>
            <div
              class="logs-container"
              id="logs-container"
              style="height: 300px"
            >
              <!-- Logs -->
            </div>
          </div>
        </div>

        <!-- Tab: Documentation -->
        <div class="tab-pane" id="tab-docs">
          <div class="settings-card">
            <h3>üìö Documentation</h3>
            <div style="line-height: 1.6; color: rgba(255, 255, 255, 0.8)">
              <p style="margin-top: 0">
                Welcome to TCP Streamer! This guide will help you understand
                each setting and optimize your streaming experience.
              </p>
            </div>
          </div>

          <div class="settings-card">
            <h3>üéØ Audio Configuration</h3>
            <div class="doc-section">
              <h4>Sample Rate</h4>
              <p>The number of audio samples captured per second.</p>
              <ul>
                <li>
                  <strong>48 kHz (Recommended)</strong>: Standard for
                  professional audio and video production
                </li>
                <li>
                  <strong>44.1 kHz</strong>: CD quality, slightly lower
                  bandwidth
                </li>
              </ul>

              <h4>Buffer Size</h4>
              <p>
                Controls the audio processing chunk size. Smaller = lower
                latency, larger = more stability.
              </p>
              <ul>
                <li>
                  <strong>Low (256)</strong>: Minimal latency, requires stable
                  system
                </li>
                <li><strong>Medium (512)</strong>: Balanced performance</li>
                <li>
                  <strong>High (1024)</strong>: Recommended for most users
                </li>
                <li>
                  <strong>Max (2048)</strong>: Use if experiencing audio
                  glitches
                </li>
              </ul>

              <h4>Ring Buffer</h4>
              <p>Internal buffer for smooth audio capture.</p>
              <ul>
                <li>
                  <strong>Balanced (4000ms)</strong>: Best for most scenarios
                </li>
                <li>
                  <strong>High/Max</strong>: Use if CPU usage is high or system
                  is under load
                </li>
              </ul>
            </div>
          </div>

          <div class="settings-card">
            <h3>üîÑ Adaptive Buffer</h3>
            <div class="doc-section">
              <p>
                Automatically adjusts buffer size based on network jitter to
                maintain optimal quality.
              </p>
              <h4>When to enable:</h4>
              <ul>
                <li>Streaming over WiFi with variable signal strength</li>
                <li>Network conditions are unpredictable</li>
                <li>Experience occasional stuttering</li>
              </ul>
              <h4>Settings:</h4>
              <ul>
                <li>
                  <strong>Min Buffer</strong>: Lowest buffer size (lower = less
                  latency)
                </li>
                <li>
                  <strong>Max Buffer</strong>: Highest buffer size (higher =
                  more stability)
                </li>
              </ul>

              <h4>Smart Buffer Sizing by Device Type (v1.5.8+)</h4>
              <p>
                The application automatically adjusts buffer settings based on
                whether you're using WASAPI loopback or standard input:
              </p>

              <table
                style="width: 100%; margin-top: 12px; border-collapse: collapse"
              >
                <thead>
                  <tr style="background: rgba(255, 255, 255, 0.05)">
                    <th
                      style="
                        padding: 8px;
                        text-align: left;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      Device Type
                    </th>
                    <th
                      style="
                        padding: 8px;
                        text-align: left;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      Base Buffer
                    </th>
                    <th
                      style="
                        padding: 8px;
                        text-align: left;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      Adaptive Range
                    </th>
                    <th
                      style="
                        padding: 8px;
                        text-align: left;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      Best/Worst Latency
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      <strong>WASAPI Loopback</strong>
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      8000ms
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      4000-12000ms
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      4s / 12s
                    </td>
                  </tr>
                  <tr style="background: rgba(255, 255, 255, 0.02)">
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      <strong>Standard Input</strong>
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      5000ms
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      2000-6000ms
                    </td>
                    <td
                      style="
                        padding: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                      "
                    >
                      2s / 6s
                    </td>
                  </tr>
                </tbody>
              </table>

              <p style="margin-top: 12px">
                <strong>Why different ranges?</strong>
              </p>
              <ul style="margin-top: 8px">
                <li>
                  <strong>WASAPI Loopback</strong>: Needs more buffering to
                  handle WiFi jitter (50-100ms), laptop CPU throttling
                  (20-50ms), and inherent WASAPI timing unpredictability
                </li>
                <li>
                  <strong>VB Audio Cable</strong>: More predictable timing
                  allows tighter buffer control and lower latency
                </li>
              </ul>

              <p style="margin-top: 12px">
                <strong>How it works:</strong> The adaptive buffer monitors
                network jitter in real-time and adjusts within these ranges. On
                stable wired networks, it shrinks to minimum. On WiFi or under
                CPU load, it expands to maximum. Memory usage is minimal (~2.3MB
                max @ 12 seconds).
              </p>
            </div>
          </div>

          <div class="settings-card">
            <h3>üîá Silence Detection</h3>
            <div class="doc-section">
              <p>Automatically stops transmission when no audio is detected.</p>
              <h4>Silence Threshold</h4>
              <p>
                Audio level (RMS) below which is considered silence. Higher
                values = more aggressive detection.
              </p>
              <ul>
                <li><strong>0</strong>: Disabled, always transmit</li>
                <li><strong>5-10</strong>: Catch complete silence only</li>
                <li>
                  <strong>10-50</strong>: Detect quiet audio (may cut fade-outs)
                </li>
              </ul>

              <h4>Silence Timeout</h4>
              <p>
                How long (in seconds) silence must persist before stopping
                transmission.
              </p>
              <ul>
                <li><strong>0</strong>: Never stop, always transmit</li>
                <li>
                  <strong>5-10 seconds</strong>: Good for music with pauses
                </li>
                <li>
                  <strong>30+ seconds</strong>: Only stop on extended silence
                </li>
              </ul>
            </div>
          </div>

          <div class="settings-card">
            <h3>‚ö° Network Optimization</h3>
            <div class="doc-section">
              <h4>DSCP Strategy</h4>
              <p>Network packet priority marking (Quality of Service).</p>
              <ul>
                <li>
                  <strong>VoIP (EF)</strong>: Highest priority, recommended for
                  audio
                </li>
                <li>
                  <strong>Low Delay</strong>: Good for real-time applications
                </li>
                <li><strong>Best Effort</strong>: No special priority</li>
              </ul>

              <h4>Precision Pacing (New!)</h4>
              <p>
                The app now uses a mathematically precise "Token Bucket" pacer
                to regulate transmission.
              </p>
              <ul>
                <li>
                  <strong>Eliminates Micro-bursts</strong>: Data is sent at the
                  exact audio rate (e.g. 48kHz).
                </li>
                <li>
                  <strong>Reduces Jitter</strong>: Prevents flooding the router
                  or server buffer.
                </li>
                <li>
                  <strong>Drift Correction</strong>: Automatically resets if the
                  stream falls too far behind.
                </li>
              </ul>

              <h4>Chunk Size</h4>
              <p>Number of samples sent per network packet.</p>
              <ul>
                <li>
                  <strong>128-256</strong>: Ultra-low latency, requires
                  excellent network
                </li>
                <li>
                  <strong>512 (Recommended)</strong>: Balanced latency/stability
                </li>
                <li>
                  <strong>1024-4096</strong>: Maximum stability for poor
                  networks
                </li>
              </ul>
            </div>
          </div>

          <div class="settings-card">
            <h3>üé¨ Optimization Scenarios</h3>
            <div class="doc-section">
              <h4>Scenario 1: Home Ethernet (Low Latency)</h4>
              <ul>
                <li>Sample Rate: 48 kHz</li>
                <li>Buffer Size: Low (256) or Medium (512)</li>
                <li>Ring Buffer: Balanced (4000ms)</li>
                <li>Adaptive Buffer: Disabled</li>
                <li>DSCP: VoIP (EF)</li>
                <li>Chunk Size: 512</li>
              </ul>

              <h4>Scenario 2: WiFi/Wireless (Stable)</h4>
              <ul>
                <li>Sample Rate: 48 kHz</li>
                <li>Buffer Size: High (1024)</li>
                <li>Ring Buffer: High (8000ms)</li>
                <li>Adaptive Buffer: Enabled (Min: 2000, Max: 10000)</li>
                <li>DSCP: VoIP (EF)</li>
                <li>Chunk Size: 1024</li>
              </ul>

              <h4>Scenario 3: Poor Network (Maximum Stability)</h4>
              <ul>
                <li>Sample Rate: 44.1 kHz (lower bandwidth)</li>
                <li>Buffer Size: Max (2048)</li>
                <li>Ring Buffer: Max (15000ms)</li>
                <li>Adaptive Buffer: Enabled (Min: 5000, Max: 20000)</li>
                <li>DSCP: VoIP (EF)</li>
                <li>Chunk Size: 2048 or 4096</li>
              </ul>

              <h4>Scenario 4: Music Streaming (Quality Priority)</h4>
              <ul>
                <li>Sample Rate: 48 kHz</li>
                <li>Buffer Size: High (1024)</li>
                <li>Ring Buffer: High (8000ms)</li>
                <li>Silence Detection: Threshold 5, Timeout 10 seconds</li>
                <li>Adaptive Buffer: Enabled for network fluctuations</li>
              </ul>
            </div>
          </div>

          <div class="settings-card">
            <h3>üí° Tips & Troubleshooting</h3>
            <div class="doc-section">
              <h4>Audio Stuttering/Dropouts</h4>
              <ul>
                <li>Increase Buffer Size to High or Max</li>
                <li>Increase Ring Buffer duration</li>
                <li>Enable Adaptive Buffer</li>
                <li>Increase Chunk Size</li>
              </ul>

              <h4>Too Much Latency</h4>
              <ul>
                <li>Decrease Buffer Size</li>
                <li>Decrease Chunk Size (if network is stable)</li>
                <li>Use wired Ethernet instead of WiFi</li>
              </ul>

              <h4>Network Congestion</h4>
              <ul>
                <li>Ensure DSCP is set to VoIP (EF)</li>
                <li>Lower Sample Rate to 44.1 kHz</li>
                <li>Enable High Priority Thread (Advanced tab)</li>
              </ul>

              <h4>Windows Loopback (WASAPI) Stuttering</h4>
              <ul>
                <li>
                  <strong>Enable Adaptive Buffer</strong>: Critical for handling
                  network + WASAPI timing variability
                </li>
                <li>
                  <strong>WiFi laptops</strong>: Expect 4-12s latency
                  (automatically applied)
                </li>
                <li>
                  <strong>Wired networks</strong>: Adaptive buffer will optimize
                  toward ~4s
                </li>
                <li>Make sure speakers/headphones are connected</li>
                <li>Check Windows sound settings</li>
                <li>
                  For lowest latency, use VB Audio Cable instead (2-6s range)
                </li>
              </ul>
            </div>
          </div>

          <div class="settings-card">
            <h3>üîå Snapcast Server Configuration</h3>
            <div class="doc-section">
              <p>
                To use TCP-Streamer with Snapcast, you need to configure TCP
                sources in your Snapcast server configuration file.
              </p>

              <h4>Configuration File Location</h4>
              <ul>
                <li>
                  <strong>Linux</strong>: <code>/etc/snapserver.conf</code>
                </li>
                <li>
                  <strong>Docker</strong>: Mount configuration file to
                  <code>/etc/snapserver.conf</code>
                </li>
              </ul>

              <h4>Basic Stream Settings</h4>
              <p>Add these global stream settings to your snapserver.conf:</p>
              <pre
                style="
                  background: rgba(0, 0, 0, 0.4);
                  padding: 12px;
                  border-radius: 6px;
                  overflow-x: auto;
                  font-family: 'Fira Code', monospace;
                  font-size: 0.85rem;
                  line-height: 1.5;
                  color: #e0e0e0;
                "
              >
[stream]
buffer = 5000
chunk_ms = 20
codec = flac</pre
              >

              <h4>TCP Source Configuration</h4>
              <p>
                Each TCP-Streamer client needs its own TCP source. Add sources
                like this:
              </p>
              <pre
                style="
                  background: rgba(0, 0, 0, 0.4);
                  padding: 12px;
                  border-radius: 6px;
                  overflow-x: auto;
                  font-family: 'Fira Code', monospace;
                  font-size: 0.85rem;
                  line-height: 1.5;
                  color: #e0e0e0;
                "
              >
# Living Room PC
source = tcp://0.0.0.0:4953?name=LivingRoom-PC&codec=flac&sampleformat=48000:16:2&idle_threshold=2000&send_silence=true

# Kitchen Laptop
source = tcp://0.0.0.0:4954?name=Kitchen-Laptop&codec=flac&sampleformat=48000:16:2&idle_threshold=2000&send_silence=true

# Office Desktop
source = tcp://0.0.0.0:4955?name=Office-Desktop&codec=flac&sampleformat=48000:16:2&idle_threshold=2000&send_silence=true

# Bedroom Laptop
source = tcp://0.0.0.0:4956?name=Bedroom-Laptop&codec=flac&sampleformat=48000:16:2&idle_threshold=2000&send_silence=true</pre
              >

              <h4>TCP Source Parameters Explained</h4>
              <ul>
                <li>
                  <strong>tcp://0.0.0.0:PORT</strong>: Listen on all interfaces
                  on specified port (each source needs unique port)
                </li>
                <li>
                  <strong>name=</strong>: Friendly name for the stream (will
                  appear in Snapcast clients)
                </li>
                <li>
                  <strong>codec=flac</strong>: Audio codec (flac recommended for
                  quality)
                </li>
                <li>
                  <strong>sampleformat=48000:16:2</strong>: Sample rate (48000
                  Hz), bit depth (16), channels (2=stereo)
                </li>
                <li>
                  <strong>idle_threshold=2000</strong>: Milliseconds before
                  stream considered idle
                </li>
                <li>
                  <strong>send_silence=true</strong>: Send silence packets when
                  no audio (keeps sync)
                </li>
              </ul>

              <h4>TCP-Streamer Configuration</h4>
              <p>
                In TCP-Streamer, configure the connection to match your Snapcast
                server:
              </p>
              <ul>
                <li>
                  <strong>Target IP</strong>: IP address of your Snapcast server
                  (e.g., 192.168.1.100)
                </li>
                <li>
                  <strong>Port</strong>: The port you configured in the TCP
                  source (e.g., 4953, 4954, etc.)
                </li>
                <li>
                  <strong>Sample Rate</strong>: Must match sampleformat (48 kHz
                  = 48000)
                </li>
              </ul>

              <h4>Testing Your Configuration</h4>
              <ol style="list-style-type: decimal; padding-left: 24px">
                <li style="margin-bottom: 8px">
                  Restart Snapcast server after configuration changes
                </li>
                <li style="margin-bottom: 8px">
                  Configure TCP-Streamer with server IP and port
                </li>
                <li style="margin-bottom: 8px">
                  Start streaming - you should see the source appear in Snapcast
                  clients
                </li>
                <li style="margin-bottom: 8px">
                  Check Snapcast server logs for connection confirmation
                </li>
              </ol>

              <h4>Common Port Assignments</h4>
              <ul>
                <li>
                  Default Snapcast control port: <strong>1704</strong> (don't
                  use for TCP streams)
                </li>
                <li>
                  TCP stream ports: <strong>4950-4999</strong> (recommended
                  range)
                </li>
                <li>
                  Ensure firewall allows incoming connections on configured
                  ports
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Action Footer -->
      <div class="footer">
        <button id="toggle-btn" class="glow-button">
          <span class="btn-text">Start Streaming</span>
        </button>
      </div>

      <!-- Footer with Credits -->
      <div class="app-footer">
        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
          "
        >
          <div style="display: flex; align-items: center; gap: 10px">
            Made with ‚ô• by Josue O.A / NaturalDevCR
            <span style="opacity: 0.5"
              >v<span id="app-version">1.5.8</span></span
            >
          </div>
          <a
            href="https://paypal.me/NaturalCloud"
            target="_blank"
            class="donate-btn"
            title="Support this project"
            style="
              display: inline-flex;
              align-items: center;
              gap: 6px;
              padding: 6px 12px;
              background: linear-gradient(135deg, #0070ba, #1546a0);
              color: white;
              text-decoration: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 600;
              transition: all 0.3s ease;
              box-shadow: 0 2px 8px rgba(0, 112, 186, 0.3);
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0, 112, 186, 0.5)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0, 112, 186, 0.3)';"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
              />
            </svg>
            Donate via PayPal
          </a>
        </div>
      </div>

      <!-- Scroll to Top Button -->
      <button
        id="scroll-to-top-btn"
        class="scroll-to-top-btn"
        style="display: none"
        title="Back to top"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
      </button>
    </div>
    <div id="toast-container"></div>
    <style>
      /* Fix for select options visibility */
      select option {
        background-color: #1a1a1a;
        color: white;
      }
    </style>
  </body>
</html>
